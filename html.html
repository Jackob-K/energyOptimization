<!-- wp:html -->
<div id="popupModal" style="display:none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background-color: rgba(0,0,0,0.6); z-index: 9999; align-items: center; justify-content: center;">
    <div style="background: #fff; width: 90%; max-width: 400px; padding: 30px; border-radius: 10px; text-align: center; position: relative;">
      
      <button id="closeModalBtn" aria-label="Zavřít okno"
        style="position: absolute; top: 10px; right: 15px; background: transparent; border: none; font-size: 26px; color: #444; transition: color 0.2s ease; cursor: pointer; line-height: 1; padding: 0; margin: 0;">
        &times;
      </button>
      
      <h2 style="margin-top: 0; text-align: center;">Stáhni si ukázku<br>e-booku</h2>
      <p>Zadej svůj e-mail a (nepovinně) jméno. Ukázka se otevře v novém panelu.</p>
  
      <input id="nameInput" type="text" name="name" autocomplete="name" placeholder="Jméno (nepovinné)" style="padding: 10px; width: 90%; border: 1px solid #ccc; border-radius: 5px; margin-top: 10px;"><br><br>
  
      <input id="emailInput" type="email" name="email" autocomplete="email" placeholder="např. jan@domena.cz" required style="padding: 10px; width: 90%; border: 1px solid #ccc; border-radius: 5px;"><br><br>
  
      <div style="display: flex; align-items: flex-start; gap: 10px; margin: 10px auto; max-width: 90%; font-size: 14px; line-height: 1.4;">
        <input type="checkbox" id="gdprCheckbox" required style="width: 20px; height: 20px; margin-top: 3px; cursor: pointer;">
        <label for="gdprCheckbox" style="text-align: left;">
          Souhlasím se zpracováním osobních údajů
          (<a href="/ochrana-osobnich-udaju" target="_blank" style="color: #0057ff;">více informací</a>)
        </label>
      </div>
      
      
  
      <button id="downloadBtn" style="padding: 10px 20px; background-color: #00aa5b; color: white; border: none; border-radius: 6px; cursor: pointer;">
        Zobrazit ukázku ZDARMA
      </button>
  
      <p id="error" style="color: red; margin-top: 1em;"></p>
  
      <input type="hidden" id="termsVersion" value="v1.0 (2025-04-07)">
    </div>
  </div>
  <!-- /wp:html -->
  



  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const modal = document.getElementById("popupModal");
      const openBtn = document.getElementById("openModalBtn");
      const closeBtn = document.getElementById("closeModalBtn");
      const downloadBtn = document.getElementById("downloadBtn");
  
      openBtn.addEventListener("click", () => {
        modal.style.display = "flex";
      });
  
      closeBtn.addEventListener("click", () => {
        modal.style.display = "none";
        resetModal();
      });
  
      downloadBtn.addEventListener("click", () => {
        const name = document.getElementById("nameInput").value;
        const email = document.getElementById("emailInput").value;
        const checkbox = document.getElementById("gdprCheckbox");
        const termsVersion = document.getElementById("termsVersion").value;
        const error = document.getElementById("error");
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  
        if (!emailRegex.test(email)) {
          error.textContent = "Zadej prosím platný e-mail.";
          return;
        }
  
        if (!checkbox.checked) {
          error.textContent = "Musíš souhlasit se zpracováním osobních údajů.";
          return;
        }
  
        error.textContent = "";
  
        // ✅ Otevřeme nové okno ihned, aby ho prohlížeč nezablokoval
        const newTab = window.open("", "_blank");
        if (newTab) {
          newTab.document.write("<p style='font-family:sans-serif; padding: 2rem;'>Načítám ukázku e-booku...</p>");
        }
  
        // ✅ Odeslání do Google Formuláře
        const formURL = "https://docs.google.com/forms/d/e/1FAIpQLSdIHWxEBfbivn0LuYFPlK4FKL3ofeFl8A8Av3RuVjq5HXoDTQ/formResponse";
        const data = new FormData();
        data.append("entry.35277659", name);
        data.append("entry.2127455844", email);
        data.append("entry.752915593", termsVersion);
  
        fetch(formURL, {
          method: "POST",
          mode: "no-cors",
          body: data
        }).then(() => {
          if (newTab) {
            newTab.location.href = "https://www.jaelektrikar.cz/wp-content/uploads/2025/04/ukazka.pdf";
          }
          modal.style.display = "none";
          resetModal();
        }).catch(() => {
          error.textContent = "Něco se nepodařilo odeslat. Zkus to prosím znovu.";
          if (newTab) {
            newTab.close();
          }
        });
      });
  
      function resetModal() {
        document.getElementById("nameInput").value = "";
        document.getElementById("emailInput").value = "";
        document.getElementById("gdprCheckbox").checked = false;
        document.getElementById("error").textContent = "";
      }
    });
  </script>